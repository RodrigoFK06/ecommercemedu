import{u as B,a as F,b as E}from"./chunk-ZJRFL6ZN-DoAIXqA1.js";import{R as I,j as e,b as j,r as p,dK as D,a8 as H,dB as M,t as S,z as K,B as b,ab as N,V as O,a2 as V,ad as L,a4 as $}from"./index-BRxROkBw.js";import{u as q,_ as Q}from"./chunk-O6K7WXYN-D26HIPYG.js";import"./lodash-Cg4g7BtM.js";import"./chunk-CIE5NZAY-B7wtm0FK.js";import{K as Z}from"./chunk-6HTZNHPT-BNU-W0Qy.js";import{R as c,u as J}from"./chunk-ZCO6EK4W-DJ0OW70G.js";import{c as U}from"./index-Dbl6QEGv.js";import{C as x}from"./checkbox-CZ5fHWTM.js";import"./chunk-C76H5USB-Bonzcoyj.js";import"./chunk-MSDRGCRR-B702EDWD.js";import"./chunk-P3UUX2T6-C49IFCOH.js";import"./chunk-YEDAFXMB-CcDlSB71.js";import"./chunk-AOFGTNG6-D36rNFbm.js";import"./table-LQZVZ6MT.js";import"./chunk-EMIHDNB7-DP6CWE5u.js";import"./plus-mini-Bwpk2Zvp.js";import"./command-bar-Bs0rk6mi.js";import"./index-CsWjJ2Pi.js";import"./chunk-PWBTCXBJ-CT3gpt_B.js";import"./format-89mWhJXf.js";import"./_isIndex-Cxwhsfnw.js";import"./x-mark-mini-BVvrhrFA.js";import"./index-B3Y03FGi.js";import"./date-picker-CKjR1CwG.js";import"./clsx-B-dksMZM.js";import"./popover-DccmW-kQ.js";import"./triangle-left-mini-DwzVyOYI.js";import"./prompt-4ErBodkw.js";var W=V({customer_group_ids:L($()).min(1)}),g=10,X=({customerId:a})=>{const{t:o}=j(),{handleSuccess:f}=J(),[r,i]=p.useState(!1),{mutateAsync:h}=D(a),u=H({defaultValues:{customer_group_ids:[]},resolver:N(W)}),{setValue:n}=u,[l,_]=p.useState({});p.useEffect(()=>{n("customer_group_ids",Object.keys(l).filter(t=>l[t]),{shouldDirty:!0,shouldTouch:!0})},[l,n]);const{searchParams:v,raw:R}=B({pageSize:g}),T=F(),{customer_groups:d,count:y,isPending:P,isError:k,error:w}=M({fields:"*customers",...v}),A=t=>{const s=typeof t=="function"?t(l):t,m=Object.keys(s);n("customer_group_ids",m,{shouldDirty:!0,shouldTouch:!0}),_(s)},C=ee(),{table:G}=q({data:d??[],columns:C,count:y,enablePagination:!0,enableRowSelection:t=>{var s;return!((s=t.original.customers)!=null&&s.map(m=>m.id).includes(a))},getRowId:t=>t.id,pageSize:g,rowSelection:{state:l,updater:A}}),z=u.handleSubmit(async t=>{i(!0);try{await h({add:t.customer_group_ids}),S.success(o("customers.groups.add.success",{groups:t.customer_group_ids.map(s=>d==null?void 0:d.find(m=>m.id===s)).filter(Boolean).map(s=>s==null?void 0:s.name)})),f(`/customers/${a}`)}catch(s){S.error(s.message)}finally{i(!1)}});if(k)throw w;return e.jsx(c.Form,{form:u,children:e.jsxs(Z,{className:"flex h-full flex-col overflow-hidden",onSubmit:z,children:[e.jsx(c.Header,{children:e.jsx("div",{className:"flex items-center justify-end gap-x-2",children:u.formState.errors.customer_group_ids&&e.jsx(K,{variant:"error",children:u.formState.errors.customer_group_ids.message})})}),e.jsx(c.Body,{className:"size-full overflow-hidden",children:e.jsx(Q,{table:G,columns:C,pageSize:g,count:y,filters:T,orderBy:[{key:"name",label:o("fields.name")},{key:"created_at",label:o("fields.createdAt")},{key:"updated_at",label:o("fields.updatedAt")}],isLoading:P,layout:"fill",search:"autofocus",queryObject:R,noRecords:{message:o("customers.groups.add.list.noRecordsMessage")}})}),e.jsxs(c.Footer,{children:[e.jsx(c.Close,{asChild:!0,children:e.jsx(b,{variant:"secondary",size:"small",children:o("actions.cancel")})}),e.jsx(b,{type:"submit",variant:"primary",size:"small",isLoading:r,children:o("actions.save")})]})]})})},Y=U(),ee=()=>{const{t:a}=j(),o=E();return p.useMemo(()=>[Y.display({id:"select",header:({table:r})=>e.jsx(x,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:i=>r.toggleAllPageRowsSelected(!!i)}),cell:({row:r})=>{const i=!r.getCanSelect(),h=r.getIsSelected()||i,u=e.jsx(x,{checked:h,disabled:i,onCheckedChange:n=>r.toggleSelected(!!n),onClick:n=>{n.stopPropagation()}});return i?e.jsx(O,{content:a("customers.groups.alreadyAddedTooltip"),side:"right",children:u}):u}}),...o],[a,o])},Ae=()=>{const{id:a}=I();return e.jsx(c,{children:e.jsx(X,{customerId:a})})};export{Ae as Component};
